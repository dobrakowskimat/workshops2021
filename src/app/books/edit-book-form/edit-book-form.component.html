<form [formGroup]="bookForm" (ngSubmit)="onSubmit()">
  <div>{{localTitle}}</div>
  <ng-container *ngIf="!this.isLoading; else spinner">
    <h2 *ngIf="!this.id">Add Book</h2>
    <h2 *ngIf="this.id">Edit Book</h2>
    <mat-form-field appearance="fill">
      <mat-label>title</mat-label>
      <input type="text" matInput formControlName="title" />
      <mat-error>
        <span *ngIf="bookForm.controls.title.hasError('required')">Title is required</span>
        <span *ngIf="bookForm.controls.title.hasError('minlength')">Title is too short</span>
        <span *ngIf="bookForm.controls.title.hasError('duplicatedTitle')">Book with this title already exist</span>
      </mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>author first name</mat-label>
      <input type="text" matInput formControlName="authorFirstName" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>author last name</mat-label>
      <input type="text" matInput formControlName="authorLastName" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>isbn</mat-label>
      <input type="text" matInput formControlName="isbn" />
      <mat-error>
        <span *ngIf="bookForm.controls.isbn.hasError('required')">Isbn is required</span>
        <span *ngIf="bookForm.controls.isbn.hasError('invalidPrefix')">Isbn msut start with 978</span>
      </mat-error>
    </mat-form-field>

  
    <mat-form-field appearance="fill">
      <mat-label>Choose a date</mat-label>
      <input
        matInput
        [matDatepicker]="picker"
        formControlName="publicationDateUtc"
      />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <div style="width: 100%;">
      <ng-container formArrayName="tags">
        <div *ngFor="let _ of tags.controls; index as i">
          <mat-form-field appearance="fill">
            <mat-label>Tag</mat-label>
            <input type="text" matInput [formControlName]="i" />
          </mat-form-field>    
          <div (click)="removeTag(i)">[x]</div> 
        </div>
      </ng-container>
      
    </div>
    <button mat-button color="primary" (click)="addTag()" type="button">Add Tag</button>

    <button mat-button color="primary" *ngIf="!this.id">Add Book</button>
    <button mat-button color="primary" *ngIf="this.id">Save Book</button>
  </ng-container>
</form>
<ng-template #spinner>
  <mat-progress-spinner
    color="blue"
    mode="indeterminate"
  ></mat-progress-spinner>
</ng-template>
